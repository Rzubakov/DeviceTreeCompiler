<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets">
    <ui:composition template="/layouts/home.xhtml">
        <ui:define name="title">UnitBus</ui:define> 
        <ui:define name="content">
            <h:form id="form">
                <div class="ui-g-4 ui-md-4 ui-lg-4">
                    <p:dataTable id="ubus" var="module" value="#{generatorBean.modules}" selectionMode="single"  rowStyleClass="#{module.isFull()? 'full' : null}" selection="#{generatorBean.selectedModule}" rowKey="#{module}" scrollable="true" scrollHeight="500">
                        <f:facet name="header">Модули</f:facet> 
                        <p:ajax event="rowSelect"  update="@form" />

                        <p:column width="30">
                            <p:graphicImage library="images" name="#{module.name}.png" width="30"/>
                        </p:column>  

                        <p:column headerText="№" >
                            <h:outputText value="#{module.number}" title="Номер на шасси"/>
                        </p:column>   
                        <p:column headerText="name">
                            <h:outputText value="#{module.name}"  title="Имя модуля (например, AIG16)"/>
                        </p:column>   
                        <p:column headerText="vname">
                            <h:outputText value="#{module.vname}" title="vname–имя ГП ввода-вывода, из которой берётся необработанное значение входов или в которую записывается значения выходов. Данная ГП соответствует ГП ввода-вывода и задаётся без имени “каталога” /var/io/ubus/. " />
                        </p:column>
                        <p:column headerText="ts_vname">
                            <h:outputText value="#{module.ts_vname}" title="ts_vname – имя, используемое как параметр в специализированных драйверах ISaGRAF."/>
                        </p:column>

                        <p:column headerText="size">
                            <h:outputText value="#{module.currentSize} из #{module.countChanel}" title="Количество каналов в текущем модуле."/>
                        </p:column>
                        <f:facet name="footer">
                            <p:commandButton  update="@form" value="AIG16" actionListener="#{generatorBean.insertModule('AIG16')}" />  
                            <p:commandButton  update="@form" value="DI32" actionListener="#{generatorBean.insertModule('DI32')}" />
                            <p:commandButton  update="@form" value="DO32" actionListener="#{generatorBean.insertModule('DO32')}" />
                            <p:commandButton  update="@form" icon="ui-icon-copy" actionListener="#{generatorBean.copyModule()}" disabled="#{generatorBean.selectedModule == null}" />
                            <p:commandButton  update="@form" icon="ui-icon-trash" disabled="#{generatorBean.selectedModule == null}" actionListener="#{generatorBean.deleteModule()}" />
                        </f:facet>
                    </p:dataTable> 
                </div> 
                <div class="ui-g-8 ui-md-8 ui-lg-8">
                    <p:dataTable id="chanels" var="chanel" value="#{generatorBean.selectedModule.chanels}" rowStyleClass="#{chanel.invert==1? 'inv' : null}"  scrollable="true" scrollHeight="500" editable="true" editMode="cell" >        
                        <f:facet name="header">Каналы </f:facet>  
                        <p:ajax event="rowSelect"  update="@form" />

                        <p:column headerText="mod" width="100">
                            <h:outputText value="#{chanel.modification}" />
                        </p:column> 
                        <p:column headerText="method" width="100">
                            <h:outputText value="#{chanel.method}" title="Метод обработки значения канала  –  целое число, идентифицирующее способ обработки значения."/>
                        </p:column>   

                        <p:column headerText="debounce" rendered="#{generatorBean.selectedModule.type == 'DI'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{chanel.debounce}" title="debounce - параметр фильтра антидребезга в модуле УСО – знаковое целое в диапазоне от 0 до 255." /></f:facet>
                                <f:facet name="input">
                                    <p:inputText id="debounce" value="#{chanel.debounce}" >
                                        <f:validateLongRange minimum="0" maximum="255" />
                                    </p:inputText>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>  
                        <p:column headerText="t_acc" rendered="#{generatorBean.selectedModule.type == 'DI'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{chanel.t_acc}" title="T_acc – период накопления – беззнаковое целое от 0 до 2000000000. Задает период мониторинга для алгоритма «подавления колебаний» в миллисекундах (мс); 0 отключает алгоритм." /></f:facet>
                                <f:facet name="input">
                                    <p:inputText id="t_acc" value="#{chanel.t_acc}">
                                        <f:validateLongRange minimum="0" maximum="2000000000" />
                                    </p:inputText>
                                </f:facet>
                            </p:cellEditor>
                        </p:column> 
                        <p:column headerText="n_acc" rendered="#{generatorBean.selectedModule.type == 'DI'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{chanel.n_acc}" /></f:facet>
                                <f:facet name="input"><p:inputText id="n_acc" value="#{chanel.n_acc}"/></f:facet>
                            </p:cellEditor>
                        </p:column> 
                        <p:column headerText="t_relax" rendered="#{generatorBean.selectedModule.type == 'DI'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{chanel.t_relax}" /></f:facet>
                                <f:facet name="input"><p:inputText id="t_relax" value="#{chanel.t_relax}"/></f:facet>
                            </p:cellEditor>
                        </p:column> 
                        <p:column headerText="invert" rendered="#{generatorBean.selectedModule.type == 'DI'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{chanel.invert}" /></f:facet>
                                <f:facet name="input"><p:inputText id="invert" value="#{chanel.invert}"/></f:facet>
                            </p:cellEditor>
                        </p:column> 
                        <p:column headerText="t_interim" rendered="#{generatorBean.selectedModule.type == 'DI' or generatorBean.selectedModule.type == 'DO'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{chanel.t_interim}" /></f:facet>
                                <f:facet name="input"><p:inputText id="t_interim" value="#{chanel.t_interim}"  disabled="#{chanel.modification eq 'SDI' or chanel.modification eq 'SDO'}" /></f:facet>
                            </p:cellEditor>
                        </p:column> 


                        <p:column headerText="filter" rendered="#{generatorBean.selectedModule.type == 'AI'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{chanel.filter}" /></f:facet>
                                <f:facet name="input"><p:inputText id="filter" value="#{chanel.filter}"  /></f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column headerText="t_filter" rendered="#{generatorBean.selectedModule.type == 'AI'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{chanel.t_filter}" /></f:facet>
                                <f:facet name="input"><p:inputText id="t_filter" value="#{chanel.t_filter}"  /></f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column headerText="zero_range" rendered="#{generatorBean.selectedModule.type == 'AI'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{chanel.zero_range}" /></f:facet>
                                <f:facet name="input"><p:inputText id="zero_range" value="#{chanel.zero_range}"  /></f:facet>
                            </p:cellEditor>
                        </p:column>     
                        <p:column headerText="sw_threshold" rendered="#{generatorBean.selectedModule.type == 'AI'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{chanel.sw_threshold}" /></f:facet>
                                <f:facet name="input"><p:inputText id="sw_threshold" value="#{chanel.sw_threshold}"  /></f:facet>
                            </p:cellEditor>
                        </p:column>   
                        <p:column headerText="threshold" rendered="#{generatorBean.selectedModule.type == 'AI'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{chanel.threshold}" /></f:facet>
                                <f:facet name="input"><p:inputText id="threshold" value="#{chanel.threshold}"  /></f:facet>
                            </p:cellEditor>
                        </p:column> 
                        <p:column headerText="t_periodic" rendered="#{generatorBean.selectedModule.type == 'AI'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{chanel.t_periodic}" /></f:facet>
                                <f:facet name="input"><p:inputText id="t_periodic" value="#{chanel.t_periodic}" /></f:facet>
                            </p:cellEditor>
                        </p:column>                                              


                        <p:column headerText="type" rendered="#{generatorBean.selectedModule.type == 'DO'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{chanel.type}" /></f:facet>
                                <f:facet name="input"><p:inputText id="type" value="#{chanel.type}"  disabled="#{chanel.modification eq 'DDO'}"  /></f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column headerText="t_pulse" rendered="#{generatorBean.selectedModule.type == 'DO'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{chanel.t_pulse}" /></f:facet>
                                <f:facet name="input"><p:inputText id="t_pulse" value="#{chanel.t_pulse}" /></f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column headerText="t_delay" rendered="#{generatorBean.selectedModule.type == 'DO'}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{chanel.t_delay}" /></f:facet>
                                <f:facet name="input"><p:inputText id="t_delay" value="#{chanel.t_delay}" /></f:facet>
                            </p:cellEditor>
                        </p:column>                       

                        <p:column style="width:50px;text-align: center">
                            <p:commandButton update="@form"  icon="ui-icon-trash" title="Удалить" actionListener="#{generatorBean.deleteChanel(chanel)}" />            
                        </p:column>
                        <p:column style="width:50px;text-align: center">
                            <p:commandButton update="@form"  icon="ui-icon-copy" title="Копировать" actionListener="#{generatorBean.copyChanel(chanel)}" />            
                        </p:column>

                        <f:facet name="footer">
                            <p:commandButton  update="@form" value="AI"  disabled="#{generatorBean.selectedModule.type != 'AI'}" actionListener="#{generatorBean.insertChanel('AI')}" />
                            <p:commandButton  update="@form" value="SDI"  disabled="#{generatorBean.selectedModule.type != 'DI'}" actionListener="#{generatorBean.insertChanel('SDI')}" />
                            <p:commandButton  update="@form" value="DDI"  disabled="#{generatorBean.selectedModule.type != 'DI'}" actionListener="#{generatorBean.insertChanel('DDI')}" />
                            <p:commandButton  update="@form" value="SDO"  disabled="#{generatorBean.selectedModule.type != 'DO'}" actionListener="#{generatorBean.insertChanel('SDO')}" />
                            <p:commandButton  update="@form" value="DDO"  disabled="#{generatorBean.selectedModule.type != 'DO'}" actionListener="#{generatorBean.insertChanel('DDO')}" />
                        </f:facet>                     
                    </p:dataTable> 


                </div>
            </h:form>
            <h:form id="setup">
                <div class="ui-g-4 ui-md-4 ui-lg-4">
                    <p:panel header="Установки"  style="margin-bottom:20px" toggleable="false" toggleSpeed="500">
                        <p:messages />
                        <h:panelGrid columns="2" cellpadding="10">
                            <h:outputText value="Кол-во ЦПУ*" />
                            <p:inputText id="start" value="#{generatorBean.startCount}" required="true" >
                                <f:validateDoubleRange minimum="1" maximum="2" />
                            </p:inputText>
                            <p:commandButton update="setup" icon="ui-icon-add" value="Save" actionListener="#{generatorBean.reOrder()}" validateClient="true" />
                            <p:commandButton  icon="ui-icon-add" value="Export" actionListener="#{generatorBean.generate()}" />
                        </h:panelGrid>
                    </p:panel> 
                </div>
            </h:form> 

        </ui:define> 
    </ui:composition>    
</html>    
